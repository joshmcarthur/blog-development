
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Spree Hosted Gateway - blog.joshmcarthur.com</title>
  <meta name="author" content="@sudojosh">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://blog.joshmcarthur.com/2011/03/10/spree-hosted-gateway/"/>
  <link href="/favicon.ico" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="blog.joshmcarthur.com" type="application/atom+xml"/>
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>


<body  >
  <div id="container">
      <header><hgroup>
  <h1><a href="/">blog.joshmcarthur.com</a></h1>
  
</hgroup>



</header>

      <div id="main" role="main">
        <div id="content">
          <div>
<article>
  
  <header>
    <h1 class="entry-title">Spree Hosted Gateway</h1>
    <p class="meta">





  



<time datetime="2011-03-10T00:00:00+13:00" pubdate  data-updated="true" >Mar 10<span>th</span>, 2011</time></p>
  </header>
  
  <p>Spree Hosted Gateway is my second &#8216;big&#8217; extension - one of the ones that isn&#8217;t
just adding one or two bits of nice functionality, but actually and end-to-end
solution to add something that I think would be useful to a broad range of
Spree developers (My first was spree-import-products, see my post on it here).
Spree (for those of you unfamiliar with it), is an open-source eCommerce
framework written in Ruby on Rails, and has recently been upgraded to Rails 3,
which has enabled extensions to now be packaged as Rails engines, making them
far easier to create, implement and share. Out of the box, Spree is able to
provide much of what a basic online store requires, but something I have felt
is missing is support for alternative payment methods that are much more
rudimentary than those catered for by Railsdog&#8217;s_fork_of_ActiveShipping.Â 
Inspired by a project I was working on at 3Months, I decided to develop an
extension that provided a new type of Payment Method (Alongside Cheque and
Creditcard) - External (Or Hosted) Gateway - this type of payment method was
characterized in the following ways:</p>

<pre><code>* Redirection - the customer was required by the gateway to be redirected
  to an off-site form to make payment.
* Tracing the payment and order: attributes required for payment (Amount,
  etc.) were gathered by the payment gateway from POSTed form data.
* Communications: there was no type of complex back-and-forth between Spree
  and the gateway provider behind the scenes - information was transmitted
  to the gateway, and all Spree is able to do from that point is listen for
  a postback and collect any information from that.
</code></pre>

<p>These type of gateways are (unfortunately) quite prevalent, especially around
small-to-medium independent companies - they tend to be cheaper than more
widely-known solutions, at the expense of a more reliable and secure
transaction for the customer.
Spree Hosted Gateway, as I have mentioned, hooks into Spree in the form of
registering itself as a Payment Method that can be configured from the admin
interface. After seeing all theÂ arbitraryÂ information that I was required to
POST to the payment gateway I was testing against, I also made it easily
extendable, and used Spree&#8217;s preferences system to allow any number of key-
value pairs to be created (Which could be modified in the Spree Admin UI),
which are automatically posted to the payment gateway when I customer is
redirected (Unless the preference key is added to the exclusion list, of
course!).
I conjunction to the &#8216;transmit&#8217; function of the extension, I have also
implemented a kind of &#8216;landing pad&#8217; for postbacks from the Payment Gateway to
hit. When this happens, the extension is able to detect whether the transaction
was successful or not, and continue processing the order. If the customer has
made an payment that is not sufficient to cover the cost of the order they are
redirected back to the payment page, and if the transaction was not successful,
an error message is presented to them.
All in all, I&#8217;m happy with this extension - it was a great way to learn about
how Spree itself handles payment methods, different types of gateway and
payment validation and handling, and I&#8217;m hoping this extension will help out
some of the Spree developers out there working on smaller stores that don&#8217;t
need such a large (expensive) gateway.</p>

  
    <footer>
      <p class="meta">
        
        





  



<time datetime="2011-03-10T00:00:00+13:00" pubdate  data-updated="true" >Mar 10<span>th</span>, 2011</time>
        


      </p>
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.joshmcarthur.com/2011/03/10/spree-hosted-gateway/" data-via="sudojosh" data-counturl="http://blog.joshmcarthur.com/2011/03/10/spree-hosted-gateway/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread"><div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'blog-joshmcarthur';
  var disqus_identifier = 'http://blog.joshmcarthur.com/2011/03/10/spree-hosted-gateway/';
  var disqus_url = 'http://blog.joshmcarthur.com/2011/03/10/spree-hosted-gateway/';
  //var disqus_developer = 1;
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside role=sidebar>
  
    <section>
  <h1>Search</h1>
  <form action="http://google.com/search" method="get" class="search">
    <fieldset role="site-search">
      <input type="hidden" name="q" value="site:blog.joshmcarthur.com" />
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    </fieldset>
  </form>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/02/28/git-browse-for-quick-repo-viewing/">Git-browse for Quick Repo Viewing</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/14/upcoming-ratemycourses/">Upcoming: RateMyCourses</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/12/add-jquery-to-any-page/">Add jQuery to Any Page Really, Really Easily</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/03/generating-gem-install-commands-from-gem-list/">Generating &#8216;Gem Install&#8217; Commands From &#8216;Gem List&#8217;</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/20/a-fun-little-bookmarklet/">A Fun Little Bookmarklet</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/joshmcarthur">@joshmcarthur</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'joshmcarthur',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("sudojosh", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/sudojosh" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @sudojosh</a>
  
</section>




  
</aside>


        </div>
      </div>
      <footer><p>
  Copyright &copy; 2012 - <a href="http://twitter.com/sudojosh">@sudojosh</a>
</p>
<p class="credits">
  <span class="octopress"><a href="http://octopress.org/">Octopress</a> powers this blog!</span>
  <span class="subtlepatterns"><a href="http://twitter.com/dwaseem">Waseem Dahman</a> made this beautiful background!</span>
<p>

</footer>
  </div>
  

  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>

